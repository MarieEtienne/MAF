---
title: "TD2 - Analyse factorielle des correspondances et analyse des correspondances multiples"
author:
  - name: MAF 2025-2026
    affiliation:
      - ENSAI - CREST
    email: marie-pierre.etienne@ensai.fr
institute: https://marieetienne.github.io/MAF/
bibliography: TPs.bib
execute:
  freeze: auto
format:
  pdf:
    papersize: a4
    geometry:
    - top=30mm
    - left=20mm
    - heightrounded
    number-sections: true
---

```{r setup, include=FALSE, eval = TRUE, message = FALSE}
library(tidyverse)
library(forcats)
library(FactoMineR)
library(factoextra)
library(kableExtra)
knitr::opts_chunk$set(echo = FALSE, comment = NA,  message = FALSE,
                      warning = FALSE, eval = FALSE,
                      fig.align = "center")
theme_set(theme_minimal())
options(ggplot2.discrete.colour=   scale_color_manual(values = wesanderson::wes_palette(name = "Darjeeling1")) )
couleur <-  wesanderson::wes_palette(name = "Darjeeling1")
scale2 <- function(x, na.rm = FALSE) (x - mean(x, na.rm = na.rm)) / ( sqrt((length(x)-1) / length(x)) *sd(x, na.rm) )

```

::: hidden
\newcommand\R{{\mathbb{R}}}
\newcommand\Xbf{{\boldsymbol{X}}}
\newcommand\norm[1]{\lVert#1\rVert}
\newcommand\xcol[1]{\boldsymbol{x}^{#1}}
\newcommand\xrow[1]{\boldsymbol{x}_{#1}}
\newcommand\xbf{\boldsymbol{x}}
\newcommand\ybf{\boldsymbol{y}}
:::

Ce TD a pour but de reprendre les notions de base de l’analyse factorielle des correspondances (AFC) et de l'analyse des correspondantes multiples vues en cours mais à partir d’exemples simples. Ce TD permet aussi de voir les commandes principales utiles pour mettre en oeuvre ce type de méthode.

# Dégustation de fromages

On s’intéresse à 8 fromages AOP, évalués par un panel de dégustateurs à l’aide de 7 descripteurs sensoriels. Pour chaque fromage, les dégustateurs devaient choisir le descripteur jugé le plus caractéristique.

**Les descripteurs sont** doux, salé, fruité, piquant, crémeux, sec, odorant

**Les fromages sont** Comté, Beaufort, Camembert, Roquefort, Munster, Chèvre frais, Reblochon, Emmental

Le tableau suivant donne, pour chaque fromage, le nombre de fois où chaque descripteur a été choisi.

## Tableau 1 : Fromages × descripteurs

```{r}
#| label: desc_fromage
#| echo: false
#| eval: true
fromage_dta <- read.table('fromage.csv', header = TRUE, sep = ",")|> column_to_rownames('Fromage')
fromage_dta   |>  kable()
```

On note ce tableau de contingence (X = (x\_{ij})) avec\
- (i = 1,\dots,I) les fromages,\
- (j = 1,\dots,J) les descripteurs.

1.  En reprenant les notations du cours combien, donner les valeurs de $k_{1+}$, $k_{+2}$, $n$, $k_{12}$, $f_{1+}$, $f_{+2}$, $f_{ij}$

2.  Sous l'hypothèse où le type de fromage et le descripteur sont deux variables indépendantes, quelle relation devrait vérifier les fréquences ?

## Profils lignes

3.  Donner pour chaque decripteur le nombre de fois où il a été choisi.

4.  Rappeler la forme de la matrice de données utilisées pour étudier les profils lignes.

5.  Rappeler le poids attribué à chaque individu (chaque ligne).

6.  Déterminer le profil ligne moyen.

7.  Rappeler la métrique utilisée et calculer l'inertie.

8.  Quel est le nombre d'axes principaux maximum ?

## Profils colonnes

Pour vérifier votre compréhension, essayer de répondre aux mêmes questions sur les profils colonnes.

## Mise en oeuvre de l'AFC

9.  A quelle valeur correspond la somme des valeurs propres ?

10. Dans quel cas, une valeur propre vaut 1 ?

11. Voici les valeurs propres obtenues sur les données de dégustation fromage, Combien d'axes avez-vous envie de considérer ?

```{r}
#| label: CA_fromage
#| echo: false
#| eval: true
#|
fromage_ca <- CA(fromage_dta, graph = FALSE, ncp = 10)
fromage_ca$eig
```

## Analyse des profils colonnes

12. Les contributions à la construction des axes de chacun des descripteurs sont données ci-dessous. Quels sont les descripteurs les plus contributifs pour le premier axe, pour le second ?

```{r}
#| label: CA_col_contrib
#| echo: false
#| eval: true


fromage_ca$col$contrib |> kable()
```

13. Le tableau ci dessous donne la qualité de la représentation. Identifier un descripteur peu contributif à la création de l'axe 1 et pourtant bien représenté.

```{r}
#| label: CA_ligne_cos2
#| echo: false
#| eval: true


fromage_ca$col$cos2|> kable()
```

14. On obtient la projection suivante pour les profils colonnes dans le premier plan principal. Que pouvez-vous dire des liens entre les descripteurs ?

```{r}
#| label: CA_colonnes_visu
#| echo: false
#| eval: true
#|
fviz_ca_col(fromage_ca)
```

15. A votre avis où devrait-on trouver le munster ?

16. Voici la représentation conjointe des profils lignes et colonnes, rédiger 5 lignes d'analyse obtenue à partir de cette représentation.

```{r}
#| label: CA_visu
#| echo: false
#| eval: true
#|
fviz_ca(fromage_ca)
```

## Variables supplémentaires

17. Selon vous, à quel endroit du plan s'attend-on à trouver un crottin de chèvre bien sec, le livarot, le caprice des Dieux ?

# Analyse des activités de Loisir

La base loisirs est un jeu de données individuel destiné à l’étude des comportements de pratique des loisirs et de leurs déterminants socio-démographiques. Chaque observation correspond à un individu, et les variables renseignent :

**les pratiques de loisirs** Un ensemble de variables binaires ou qualitatives décrivant la participation à différentes activités culturelles, récréatives ou domestiques : Lecture, Écouter.musique, Cinéma, Spectacle, Exposition, Ordinateur, Sport, Marche, Voyage, Jouer.musique, Collection, Activité.bénévole, Bricolage, Jardinage, Tricot, Cuisine, Pêche, TV (niveau d'utilisation de 0 à 4).

**Des indications socio-démographiques** Sexe, Âge, Situation.matrimoniale et Profession fournissent des informations permettant de caractériser les individus et d’expliquer les variations de comportements de loisirs.Il y a quelques valeurs manquantes.

**Une Variable synthétique** Nb.activités est une variable dérivée indiquant, pour chaque individu, le nombre total d’activités pratiquées parmi celles listées.

Ces données sont disponibles sur le site de [Francois Husson](https://husson.github.io/data.html)

```{r}
#| label: import_loisirs
#| eval: true

loisirs <- read.table("http://factominer.free.fr/course/donnees/AnaDo_JeuDonnees_Loisirs.csv",
                     header=TRUE, sep=";", fileEncoding="latin1", stringsAsFactors = TRUE)
loisirs <- loisirs |> mutate(TV = as.factor(TV))
```

1.  On cherche à construire une visualisation de cette base, permettant de mettre en évidence des liens potentiels entre différentes activités. Quelle est la méthode adaptée ?

2.  Rappeler les éléments clés pour construire une ACM (tableau de données, métrique et poids).

3.  L'analyse des correspondances multiples est mise en oeuvre à l'aide de la fonction `MCA` ci-dessous. Seules les activités de loisirs sont utilisées pour construire ACM. Indiquez toutes les variables supplémentaires.

```{r}
#| label: mca_loisirs
#| eval: true
res.mca <- MCA(loisirs,quali.sup=19:22,quanti.sup=23, graph = FALSE)
```

4.  A partir du graphique d'inertie ci-dessous, discuter la répartition de l'inertie sur les 2 premières dimensions.

```{r}
#| label: eig_loisirs
#| eval: true
res.mca$eig |> kable()
```

## Représentation des variables

5.  Expliquer ce qui est représenté sur le graphique suivant et discuter du rôle particulier de la variable quantitative supplémentaire.

```{r}
#| eval: true
plot(res.mca,   choix = "var", invisible = "quali.sup", axes = c(1,2))
```

6.  Quelles sont les variables les mieux représentées sur l'axe 1, l'axe 2 ?

## Représentation des différentes modalités.

Le graphique ci-dessous représente l'ensemble des modalités

```{r}
#| eval: true
plot(res.mca,   choix = "ind", invisible = c("ind", "quali.sup", "quanti.sup"), axes = c(1,2)) + xlim(c(-1,1))
```

7.  Pour y voir plus clair, on s'intéresse au 10 variables les plus contributives, quel enseignement pouvez-vous tirer de ce graphique ?

```{r}
#| eval: true
#| message: false
plot(res.mca,   choix = "ind", invisible = c("ind", "quali.sup", "quanti.sup"), axes = c(1,2), selectMod="contrib 10") +xlim(c(-1,1))+ ylim(c(-1,1))
```

8.  Peut-on affirmer que les personnes qui vont à des expositions ont également tendance à aller au spectacle ?

9.  Les personnes adeptes du jardinage passent-elles peu de temps sur leur ordinateur ?

10. A votre avis quelles sont les caractéristiques démographiques des personnes adeptes du Jardinage ?

11. Dans le graphique ci-dessous, on ne représente que les modalités dont le $cos^2$ est supérieur à 0.4. Expliquer de quel $cos^2$ il est question. Comparer avec le graphique précédent. Est ce surprenant ?

```{r}
#| eval: true
seuil_cos <- 0.4
liste_mod <- res.mca$var$cos2[, 1:2] |> rowSums()  |> sort(, decreasing = TRUE)
mod_names <-liste_mod[liste_mod> seuil_cos] |> names()

plot(res.mca,   choix = "ind", invisible = c("ind", "quanti.sup"), axes = c(1,2), selectMod=mod_names) +xlim(c(-1,1))+ ylim(c(-1,1))
```

## Prise en compte de variables supplémentaires.

On s'intéresse à la variable suppémentaire Age.

12. Selon votre intuition à la question 10, ou devrait-on retrouer les personnes de 65 à 75 ans ?

```{r}
#| eval: true
plot(res.mca,   choix = "ind", invisible = c("ind", "quanti.sup", "var"), axes = c(1,2), select = (cos2 =10))
select_mod <- names(sort(rowSums(res.mca$quali.sup$cos2[, 1:2]), decreasing = TRUE)[1:9])


```

13. Que constatez-vous pour la variable Age ?

14. Le tableau ci-dessous donne la qualité de représentation pour chacune des modalités de la variable Age. Quelle information peut-on en tirer ?

```{r}
#| eval: true
rowSums(res.mca$quali.sup$cos2[,1:2])[3:8]
```

15. On refait l'analyse en gardant plus de dimensions principales (argument `ncp` de `MCA`) et on illustre la qualité de la représentation des `(25-35]` pour chaque axe principal. Comment expliquer cette qualité de représentation ?

```{r}
#| eval: true
res.mca <- MCA(loisirs,quali.sup=c(19:22),quanti.sup=23, ncp = 21)
barplot(res.mca$quali.sup$cos2[3,])
```

16. Quel est le plan le plus pertinent pour bien visualiser les sondés de la catégories `(25-35]` ?

17. Dans le graphique ci-dessous, seules les modalités dont le cos2 sont supérieures à 0.2 sont représentées. Discuter ce que vous voyez en 5 lignes max.

```{r}
#| eval: true
axe_s <- c(2,8)
cos2_s <- 0.2

cos2_var <- rowSums(res.mca$var$cos2[,axe_s]) |> sort(decreasing = TRUE)
liste_var<- cos2_var[cos2_var>cos2_s] |> names()
liste_age <- res.mca$quali.sup$cos2[3:10,] |>   rownames()

plot(res.mca,   choix = "ind", invisible = c("ind", "quanti.sup"), axes = c(2,8), selectMod=c(liste_var,liste_age) )
```

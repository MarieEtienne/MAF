<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marie-Pierre Etienne">
<meta name="dcterms.date" content="2024-11-11">

<title>Labs1 - Analyse en composante Principale – Méthodes d’analyse factorielle</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="mpe_pres_revealjs.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Méthodes d’analyse factorielle</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MarieEtienne/MAF.git"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-references-" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">References</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-references-">    
        <li>
    <a class="dropdown-item" href="./references_maf.html">
 <span class="dropdown-text">Cours</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./references_linear.html">
 <span class="dropdown-text">Algèbre linéaire</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cours" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Cours</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-cours">    
        <li>
    <a class="dropdown-item" href="./01_intro.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./01_acp.html">
 <span class="dropdown-text">Analyse en Composantes Principales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./01_afm.html">
 <span class="dropdown-text">Analyse Factorielle Multiple</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tp" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">TP</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tp">    
        <li>
    <a class="dropdown-item" href="./TP1.html">
 <span class="dropdown-text">Labs1 - Analyse en composante Principale</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#avant-propos" id="toc-avant-propos" class="nav-link active" data-scroll-target="#avant-propos">Avant-propos</a></li>
  <li><a href="#statistiques-avec-r-à-lensai" id="toc-statistiques-avec-r-à-lensai" class="nav-link" data-scroll-target="#statistiques-avec-r-à-lensai">Statistiques avec R à l’Ensai</a></li>
  <li><a href="#de-bonnes-pratiques" id="toc-de-bonnes-pratiques" class="nav-link" data-scroll-target="#de-bonnes-pratiques">De bonnes pratiques</a>
  <ul class="collapse">
  <li><a href="#préparation-de-lenvironnement" id="toc-préparation-de-lenvironnement" class="nav-link" data-scroll-target="#préparation-de-lenvironnement">Préparation de l’environnement</a></li>
  <li><a href="#structure-document-quarto" id="toc-structure-document-quarto" class="nav-link" data-scroll-target="#structure-document-quarto">Structure Document Quarto</a>
  <ul class="collapse">
  <li><a href="#en-tête-yaml" id="toc-en-tête-yaml" class="nav-link" data-scroll-target="#en-tête-yaml">En-tête YAML</a></li>
  <li><a href="#texte-en-markdown" id="toc-texte-en-markdown" class="nav-link" data-scroll-target="#texte-en-markdown">Texte en Markdown</a></li>
  <li><a href="#blocs-de-code" id="toc-blocs-de-code" class="nav-link" data-scroll-target="#blocs-de-code">Blocs de Code</a></li>
  <li><a href="#rendu-et-exportation-du-document" id="toc-rendu-et-exportation-du-document" class="nav-link" data-scroll-target="#rendu-et-exportation-du-document">Rendu et Exportation du Document</a></li>
  <li><a href="#création-du-document" id="toc-création-du-document" class="nav-link" data-scroll-target="#création-du-document">Création du document</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#analyse-des-caractéristiques-géochimiques-des-sols-en-forêt-de-bornéo" id="toc-analyse-des-caractéristiques-géochimiques-des-sols-en-forêt-de-bornéo" class="nav-link" data-scroll-target="#analyse-des-caractéristiques-géochimiques-des-sols-en-forêt-de-bornéo">Analyse des caractéristiques géochimiques des sols en forêt de Bornéo</a>
  <ul class="collapse">
  <li><a href="#comprendre-les-données" id="toc-comprendre-les-données" class="nav-link" data-scroll-target="#comprendre-les-données">Comprendre les données</a>
  <ul class="collapse">
  <li><a href="#importation" id="toc-importation" class="nav-link" data-scroll-target="#importation">Importation</a></li>
  <li><a href="#une-première-exploration" id="toc-une-première-exploration" class="nav-link" data-scroll-target="#une-première-exploration">Une première exploration</a></li>
  <li><a href="#représentation-bivariée" id="toc-représentation-bivariée" class="nav-link" data-scroll-target="#représentation-bivariée">Représentation bivariée</a></li>
  </ul></li>
  <li><a href="#approche-factorielle" id="toc-approche-factorielle" class="nav-link" data-scroll-target="#approche-factorielle">Approche factorielle</a>
  <ul class="collapse">
  <li><a href="#mise-en-place-de-lapproche-factorielle" id="toc-mise-en-place-de-lapproche-factorielle" class="nav-link" data-scroll-target="#mise-en-place-de-lapproche-factorielle">Mise en place de l’approche factorielle</a></li>
  <li><a href="#acp-à-la-main" id="toc-acp-à-la-main" class="nav-link" data-scroll-target="#acp-à-la-main">ACP “à la main”</a></li>
  </ul></li>
  <li><a href="#mise-en-oeuvre-pratique-de-lacp-pour-analyse-des-données-de-sol" id="toc-mise-en-oeuvre-pratique-de-lacp-pour-analyse-des-données-de-sol" class="nav-link" data-scroll-target="#mise-en-oeuvre-pratique-de-lacp-pour-analyse-des-données-de-sol">Mise en oeuvre pratique de l’ACP pour analyse des données de sol</a>
  <ul class="collapse">
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a></li>
  <li><a href="#individus" id="toc-individus" class="nav-link" data-scroll-target="#individus">Individus</a></li>
  </ul></li>
  <li><a href="#comment-trouver-la-représentation-qui-discrimine-le-mieux-les-types-de-sol." id="toc-comment-trouver-la-représentation-qui-discrimine-le-mieux-les-types-de-sol." class="nav-link" data-scroll-target="#comment-trouver-la-représentation-qui-discrimine-le-mieux-les-types-de-sol.">Comment trouver la représentation qui discrimine le mieux les types de sol.</a></li>
  </ul></li>
  <li><a href="#performances-au-décathlon" id="toc-performances-au-décathlon" class="nav-link" data-scroll-target="#performances-au-décathlon">Performances au Décathlon</a>
  <ul class="collapse">
  <li><a href="#plan-de-létude" id="toc-plan-de-létude" class="nav-link" data-scroll-target="#plan-de-létude">Plan de l’étude</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Labs1 - Analyse en composante Principale</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Marie-Pierre Etienne <a href="mailto:marie-pierre.etienne@ensai.fr" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            ENSAI - CREST
          </p>
        <p class="affiliation">
            https://marieetienne.github.io/MAF/
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 11, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="hidden">
<p>$$</p>
<p>$$</p>
</div>
<section id="avant-propos" class="level1">
<h1>Avant-propos</h1>
<p>Les TP du cours MAF servent deux objectifs. Revenir sur certaines notions de cours et donner des outils pratiques pour mettre ne oeuvre les méthodes vues, et réfléchir à quelles informations elles peuvent apportées pour une ceratine application.</p>
<p>Il est donc fréquent que l’on fasse certaine partie avec peu d’outils (à la main) pouur bien faire le lien avec les concets de cours, tandis que d’autres servent d’exemple pour illustrer comment dérouler une analyse sur un jeu de données en particulier.</p>
</section>
<section id="statistiques-avec-r-à-lensai" class="level1">
<h1>Statistiques avec R à l’Ensai</h1>
<p>Le Logiciel R est libre et disponible sur divers plateformes <a href="https://www.r-project.org/">sur cette page</a> et le logiciel <a href="https://posit.co/download/rstudio-desktop/">Rstudio</a> est une interface agréable pour l’utilisation de R Vous pouvez installer ces logiciels sur votre ordinateur, toutefois il faut être prêt à gérer soi-même les problèmes de version, d’installation etc.</p>
<p>Pour plus de sérénité il est préférable d’utiliser les serveurs auqxuels vous pouvez vous connecter par l’url suivante (depuis n’importe où)</p>
<p><span class="center">http://clust-n1.ensai.fr ; ou ; http://clust-n2.ensai.fr</span></p>
<p>Pour accéder en plus à une interface graphique, par exemple pour utiliser <code>shiny</code> et notamment <code>Factoshiny</code>, il faut être à l’ENSAI et utiliser l’adresse</p>
<p><span class="center">http://clust-n1.domensai.ecole ; ou ; http://clust-n2.domensai.ecole</span></p>
</section>
<section id="de-bonnes-pratiques" class="level1">
<h1>De bonnes pratiques</h1>
<section id="préparation-de-lenvironnement" class="level2">
<h2 class="anchored" data-anchor-id="préparation-de-lenvironnement">Préparation de l’environnement</h2>
<ul>
<li>Ouvrir un navigateur web et se connecter au serveur de calcul.</li>
<li>Créer un Projet (File –&gt; New Project) ou bien en cliquant en haut à droite. Le travail par projet facilite l’accès aux données (notamment lorsque l’on passe d’un ordinateur à l’autre) et permet surtout de “zapper” d’un projet à un autre.</li>
<li>Choisissez Créer un projet depuis un Nouveau Repertoire, nommez le <code>MAF_TD1</code> (comme toujours en programmation on évite les caractères spéciaux, c’est-à-dire, les accents, les espaces entre autres)</li>
<li>Pour pouvoir garder le code et l’interprétation des résultats au même endroit nous allons utiliser un type de document <a href="https://quarto.org/">Quarto</a> qui est adapté pour mélanger code et texte. Quarto accepte du code R mais aussi Python et Julia. Créer un fichier <code>TP1_Exo1.qmd</code>. Vous pouvez utiliser <a href="TP_MAF_exemple.qmd">le fichier d’exemple</a>.</li>
<li>Passez en mode <code>source</code>(en haut à gauche) au lieu de <code>Visual</code> ceci permet de mieux comprendre la structure d’un document quarto.</li>
</ul>
</section>
<section id="structure-document-quarto" class="level2">
<h2 class="anchored" data-anchor-id="structure-document-quarto">Structure Document Quarto</h2>
<p>Un document Quarto se divise en plusieurs sections clés qui facilitent l’organisation de l’analyse, l’intégration de code, et la présentation des résultats. Voici une présentation des principales composantes :</p>
<section id="en-tête-yaml" class="level3">
<h3 class="anchored" data-anchor-id="en-tête-yaml">En-tête YAML</h3>
<p>C’est la section de métadonnées du document. Elle est située en haut du fichier et est encadrée par des lignes —. On y définit des informations essentielles telles que : title : le titre du document ; author : l’auteur ou les auteurs du document ; date : la date de création, qui peut être dynamique avec R, par exemple en utilisant date: “r Sys.Date()” ; format : le format de sortie (HTML, PDF, Word, revealjs pour les présentations, etc.).</p>
<pre><code>Exemple d'en-tête YAML :</code></pre>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Analyse de Données avec R"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"Votre Nom"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span><span class="kw">:</span><span class="at"> </span><span class="st">"`r Sys.Date()`"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span><span class="kw">:</span><span class="at"> html</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="texte-en-markdown" class="level3">
<h3 class="anchored" data-anchor-id="texte-en-markdown">Texte en Markdown</h3>
<p>La rédaction du texte dans Quarto utilise la syntaxe Markdown pour structurer le contenu de manière simple et lisible. Markdown permet de formater le texte (titres, listes, liens, etc.) sans avoir à écrire du code complexe. Par exemple :</p>
<p>Exemple :</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Ce document présente une analyse de données en utilisant **R**.</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Point 1</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Point 2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le markup langage markdown permet aussi d’insérer des formules mathématiques, comme du latex.</p>
</section>
<section id="blocs-de-code" class="level3">
<h3 class="anchored" data-anchor-id="blocs-de-code">Blocs de Code</h3>
<p>Quarto permet d’intégrer du code R (mais aussi Python, et Julia) grâce à des blocs de code, <code>chunks</code>. Les blocs de code sont délimités par trois accents graves (triple backtick), avec le langage spécifié entre accolades ({}). Les blocs peuvent exécuter du code directement dans le document et afficher les résultats en ligne.</p>
<p>Exemple de bloc de code en R :</p>
<p>Les options de rendu du bloc de code peuvent être précisées. Par exemple ici * #| echo: true permet de montrer le code * #| eval: false permet de ne pas executer le code</p>
<p>Une présentation plus complète des options, pour un rendu plus fin est disponible sur <a href="https://quarto.org/docs/computations/r.html#chunk-options">le site de Quarto</a>.</p>
<p>Le bloc peut être défini en tapant * manuellement les triples backticks, * ou en utilisant le menu Code –&gt; Insert Chunk, * ou avec le raccourci CTRL + ALT + i</p>
</section>
<section id="rendu-et-exportation-du-document" class="level3">
<h3 class="anchored" data-anchor-id="rendu-et-exportation-du-document">Rendu et Exportation du Document</h3>
<p>Une fois le document terminé, on peut le rendre dans le format souhaité en utilisant la commande suivante dans le terminal <code>quarto render mon_document.qmd</code>ou en cliquant sur Render dans RStudio.</p>
<p>Cette commande crée une version finalisée du document dans le format spécifié (HTML, PDF, etc.).</p>
<p>Avec Quarto on peut tout autant faire des slides, des rapports en pdf, en word etc. Ceci permet de s’assurer que les résulats présentés sont ceux de l’analyse et c’est un <em>premier pas important dans le sens d’assurer plus de reproductibilité en science</em>. (d’autres outils sont utiles voir <a href="https://marieetienne.github.io/reproductibilite/_presentation/#1">ici</a> )</p>
<p>C’est très utile en TP puisque vous pouvez commentez les analyses proposés, les résultats obtenus directement dans le TP.</p>
<p>Plus largement, en suivant cette structure, vous pouvez organiser vos analyses de manière professionnelle et claire.</p>
</section>
<section id="création-du-document" class="level3">
<h3 class="anchored" data-anchor-id="création-du-document">Création du document</h3>
<p>Lors de la mise en place de l’analyse, on peut éxécuter chaque chunk avec le raccourci CTL + Enter, ou en cliquant sur la petite flèxche verte en haut à droit du chunk.</p>
</section>
</section>
</section>
<section id="analyse-des-caractéristiques-géochimiques-des-sols-en-forêt-de-bornéo" class="level1">
<h1>Analyse des caractéristiques géochimiques des sols en forêt de Bornéo</h1>
<p>Il s’agit ici de carcatériser les propriétés physico chimiques des sols. Pour ceci on a prélevé des échantillons dans diffférentes forêts de Borneo et on cherche à mettre en évidence des typologies de sols et à identifier des prélèvements qui se ressemblent. Les données consistent en la mesure de caractéristiques géochimiques de sols dans une forêt pluviale de Bornéo et sont issues de <span class="citation" data-cites="sellan2021differences">Sellan et al. (<a href="#ref-sellan2021differences" role="doc-biblioref">2021</a>)</span>.</p>
<section id="comprendre-les-données" class="level2">
<h2 class="anchored" data-anchor-id="comprendre-les-données">Comprendre les données</h2>
<section id="importation" class="level3">
<h3 class="anchored" data-anchor-id="importation">Importation</h3>
<p>Nous allons importer les données et les manipuler en utiliser les possibilités de la suite de package <code>tidyverse</code>. Les données sont <a href="https://marieetienne.github.io/datasets/donnees_sols.txt">disponibles sur ce lien</a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># Pour la manipulation de données</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>donnees_sols <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"https://marieetienne.github.io/datasets/donnees_sols.txt"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sep =</span> <span class="st">";"</span>, <span class="co"># separateur de champs</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="co"># 1ere ligne donne le nom des colonnes</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)  <span class="co"># Encodage initial du fichier</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le jeu de données <code>donnees_sols</code> regroupe donc les mesures chimiques surtous les types de sols. Les auteurs précisent le préfixe Exc signifie échangeable et le préfixe P signifie Available.</p>
</section>
<section id="une-première-exploration" class="level3">
<h3 class="anchored" data-anchor-id="une-première-exploration">Une première exploration</h3>
<p>Proposer des résumés univariés de chaque variable présente dans le jeu de données.</p>
<ul>
<li><p>Combien y a t-il de variables quantitatives / qualiltatives?</p></li>
<li><p>Combien d’échantillons sont mesurés par site ?</p></li>
<li><p>Sont-ils tous prélevés à la même profondeur ?</p></li>
<li><p>Quel est le pH moyen tout site/Sol et Profondeur confondu ?</p></li>
<li><p>Quelle la variance de la teneur en Eau ? Quelle est la variance de la teneur en Sodium (Na) ?</p></li>
</ul>
</section>
<section id="représentation-bivariée" class="level3">
<h3 class="anchored" data-anchor-id="représentation-bivariée">Représentation bivariée</h3>
<p>Pour appréhender le jeu de données, il est utile de commencer par comprendre les relations deux à deux entre les variables. On peut commencer par la corrélation entre celles-ci</p>
<p>En utilisant le package <code>GGally</code>et notamment la fonction ggpairs, proposer une représentation bivariée des différents couples de variables.</p>
<p>La visualisation est difficile, d’où l’intérêt d’une approche multivariée.</p>
</section>
</section>
<section id="approche-factorielle" class="level2">
<h2 class="anchored" data-anchor-id="approche-factorielle">Approche factorielle</h2>
<p>Le but est de faire émerger des typologies de sol. Pour le moment nous mettons de coté les variables qualitatives.</p>
<section id="mise-en-place-de-lapproche-factorielle" class="level3">
<h3 class="anchored" data-anchor-id="mise-en-place-de-lapproche-factorielle">Mise en place de l’approche factorielle</h3>
<ul>
<li>Comment décider le poids attribuer à chaque individu ?</li>
</ul>
<!-- par défaut le poids est 1/n sauf si autre bonne raison  -->
<ul>
<li>Quelle distance entre variables choisir ?</li>
</ul>
<!-- Ici les varaibles ont des ordres de grandeur différent, la mesure de pH n'est pas comparable avec la teneur en Sodium par exemple, on va faire une ACP normée. on pourrait classer les variables par trype et faire une AFM mais on a peu de connaissance sur les groupes  -->
<ul>
<li>Quelles varaibles choisissez vous de considérer comme supplémentaires (qualitative et ou quantitative)</li>
</ul>
<!-- on prend uniquement les variables quali en supplméentaires  -->
<ul>
<li>Quelle doit être l’inertie du nuage ?</li>
</ul>
<!-- Si on a bien choisi une ACP normée on s'attend à avoir 18 d'inertie, mais le pourcentage de Argile Limon ou sable somme à 1, donc on devra avoir  17 variables indépendantes et 17 d'inertie. Il y a toutefois sans doute à cause des arrondis certains sites qui ne somment pas à 100 -->
<p>Ces choix étant faits, on peut lancer une analyse en composante principale.</p>
</section>
<section id="acp-à-la-main" class="level3">
<h3 class="anchored" data-anchor-id="acp-à-la-main">ACP “à la main”</h3>
<p>L’ACP consiste à construire une nouvelle base de <span class="math inline">\({\mathbb{R}}^p\)</span> pour représenter les individus.</p>
<ul>
<li><p>Combien vaut <span class="math inline">\(p\)</span> ici ?</p></li>
<li><p>Cette base est formée des veteurs propres d’une matrice. De quelle matrice parle-t-on ?</p></li>
</ul>
<!-- C'est la matrice de corrélation des varaibles si on fait une ACP normée  -->
<ul>
<li>A l’aide de la fonction <code>eigen</code> représenter la suite décroissante des valeurs propres. A partir de combien de vecteurs de base considérez-vous que l’information apportée devient négligeable?</li>
</ul>
<p>Pour réaliser l’ACP, on utilise deux packages <code>FactomineR</code> qui fait les calculs et <code>factoextra</code>pour des sorties plus agréables</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vous pouvez maintenant lancer l’ACP sur le jeu de données du sol.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sols.pca <span class="ot">&lt;-</span> <span class="fu">PCA</span>(<span class="at">X =</span> donnees_sols,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale.unit =</span> , <span class="do">## ACP normée ou non ? </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncp =</span> , <span class="do">## nombre de composantes principales à garder, dans le doute on garde tout</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ind.sup =</span> , <span class="do">## numero des lignes des individus supplémentaires</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">quanti.sup =</span> , <span class="do">## numero des colonnes des variables quanti sup</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">quali.sup =</span> , <span class="do">## numero des colonnes des variables quanti sup</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.w =</span> , <span class="do">## poids des individus</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.w =</span> , <span class="do">## poids des variables </span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph =</span> , <span class="do">## TRUE or FALSe doit on sortir les graphes</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axes =</span> ,  <span class="do">## pour quels axes </span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sols.pca <span class="ot">&lt;-</span> <span class="fu">PCA</span>(<span class="at">X =</span> donnees_sols[, <span class="sc">-</span><span class="dv">2</span>],</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale.unit =</span> <span class="cn">TRUE</span>, <span class="do">## ACP normée ou non ? </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncp =</span> <span class="dv">18</span>, <span class="do">## nombre de composantes principales à garder, dans le doute on garde tout</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quali.sup =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="do">## numero des colonnes des variables quali sup</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph =</span> <span class="cn">FALSE</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Indiquer comment est construit l’objet <code>sols.pca</code> et détailler ce qu’il contient.</p></li>
<li><p>A l’aide de la commande <code>sols.pca$eig</code>, visualisez le pourcentage d’information expliqué par chaque composante principale (ou nouvelle colonne). Comparer avec ce qui a été trouvé “à la main”. Les vecteurs propres sont disponibles dans sols.pca<code>$svd$V</code>, comparer également les deux premiers axes principaux et les vecteurs propres trouvés à la main.</p></li>
</ul>
</section>
</section>
<section id="mise-en-oeuvre-pratique-de-lacp-pour-analyse-des-données-de-sol" class="level2">
<h2 class="anchored" data-anchor-id="mise-en-oeuvre-pratique-de-lacp-pour-analyse-des-données-de-sol">Mise en oeuvre pratique de l’ACP pour analyse des données de sol</h2>
<ul>
<li>Représentez l’éboulis des valeurs propres à partir de la sortie <code>sols.pca</code> (ce qui a déjà été fait à la main précédemment).</li>
</ul>
<ul>
<li>A partir de combien d’axes factoriels considérez vous que l’information apportée devient négligeable?</li>
</ul>
<section id="variables" class="level3">
<h3 class="anchored" data-anchor-id="variables">Variables</h3>
<p>Le package <code>factoextra</code>donne des outils pour produire des sorties les plus lisibles possibles.</p>
<p>Pour représenter le cercle des corrélations dans un plan principal, on utilise la fonction <code>fviz_pca_var</code>. Sur chaque graphe, qu’est ce qui est représenté?</p>
<ul>
<li>Pour plus de lisibilité, refaites le même graphique avec seulement les variables bien représentées (par exemple celles pour lesquelles le cos2 de l’angle entre la variable initiale et la variable projetée dans le plan représenté est supérieur à 0.8). Jouer sur les différentes repésentations pour bien comprendre quelle information est disponible sur chaque projection</li>
</ul>
<p>Il est important de noter qu’on peut grâce à <code>resultat_acp</code>, tracer ce graphique nous même et donc modifier son apparence à notre guise.</p>
<ul>
<li>Avec la fonction <code>corrplot</code> et l’objet <code>sols.pca$var$cor</code>, représentez les corrélations entre anciennes et nouvelles variables.</li>
</ul>
<ul>
<li>Quel est l’intérêt du cercle de corrélation par rapport à ce dernier graphique?</li>
</ul>
</section>
<section id="individus" class="level3">
<h3 class="anchored" data-anchor-id="individus">Individus</h3>
<p>Pour représenter la projection des individus dans un plan principal, on utilise la fonction <code>fviz_pca_ind</code>.</p>
<ul>
<li>Dans la fonction <code>fviz_pca_ind</code>, en rajoutant <code>col.ind = donnees_sols$Sol</code>, coloriez les individus selon leur typologie de sol.</li>
</ul>
<!-- Elements d'explication pour les TDS -->
<!--  les 2 premiers axes sont facilement interprétables, et que le 3e est pas si clair (bien que le pH semble assez lié), mais le 4e l'est très bien. -->
<!-- Et notamment ce qui est cool c'est que le plan (1, 2) permet de bien distinguer la profondeur des échantillons, alors que le plan (1, 4) permet de  bien distinguer les trois grands types de sol. (Axe 1 = Alluvial d'un coté, Grès/ Dunaire de l'autre, Axe 4 permet ensuite de distinguer entre Grès et Dunaire). -->
<ul>
<li><p>Représenter la projection des individus dans les premiers plans principaux. Quel plan vous semble bien distinguer les types de sol? Comment interprétez-vous alors les typologies de sols au vu des premières variables?</p></li>
<li><p>Faites le même exercice avec les profondeurs et essayez d’interpréter quel(s) gradient(s) distingue(nt) bien les profondeurs?</p></li>
</ul>
</section>
</section>
<section id="comment-trouver-la-représentation-qui-discrimine-le-mieux-les-types-de-sol." class="level2">
<h2 class="anchored" data-anchor-id="comment-trouver-la-représentation-qui-discrimine-le-mieux-les-types-de-sol.">Comment trouver la représentation qui discrimine le mieux les types de sol.</h2>
<ul>
<li><p>Quelle méthode vous semble adaptée ?</p></li>
<li><p>Pouvez-vous proposer un métodologie pour la mettre en oeuvre</p></li>
</ul>
<!-- l'AFD sera vue plus en détaille dan sle sprochains TDs, ne pas insister -->
<!-- FactormineR Ne proose pas d'AFD, on peut utiliser la fonction suivante qui a été codée par M. Marbac.  -->
<!-- Il est tout à fait possible de la donner aux étudiants -->
<!-- Mais c'est bien de leur faire réfléchir à l'implémentation à partir de l'ACP à la main -->
<!-- ## Attention z doit être numérique -->
<!-- mon.AFD <- function(x, z){ -->
<!--   x <- as.matrix(x) -->
<!--   n <- nrow(x) -->
<!--   Vt <- cov(x) * (n-1) / n -->
<!--   nk <- table(z) -->
<!--   K <- length(nk) -->
<!--   g <- colMeans(x) -->
<!--   gk <- matrix(0, K, ncol(x)) -->
<!--   for (k in 1:K) gk[k,] <- colMeans(x[which(z==k), ]) -->
<!--   Vb <- (t(gk)%*%diag(nk)%*%gk) / n - g%*%t(g) -->
<!--   res.afd <- eigen(Vb %*% solve(Vt)) -->
<!--   res.afd$values <- as.numeric(res.afd$values[1:(K-1)]) -->
<!--   res.afd$vectors <- sapply(1:(K-1), function(u) as.numeric(res.afd$vectors[,u])) -->
<!--   x %*% solve(Vt) %*% res.afd$vectors -->
<!-- } -->
<!-- x <- donnees_sols_quanti -->
<!-- z <- donnees_sols$Sol -->
<!-- mon.AFD(x,as.numeric(z)) -->
</section>
</section>
<section id="performances-au-décathlon" class="level1">
<h1>Performances au Décathlon</h1>
<p><em>potentiellement commencer en TP mais surtout à faire chez soi pour vérifier qu’on a compris</em></p>
<p>L’objectif de l’étude est de mettre en évidence des profils d’athlètes parmi des décathloniens (, mais également de mettre en évidence si certaines épreuves se ressemble (quand on est excellent au 100m, est on aussi excellent au saut en longueur ?)</p>
<p>Les données sont disponibles dans le package <code>FactoMineR</code> et peuvent etre chargée par la commande <code>data(decathlon)</code>après avoir chargé le package <code>FactoMineR</code>. Ces données portent sur les résultats aux épreuves du décathlon lors de deux compétitions d’athlétisme qui ont eu lieu à un mois d’intervalle: les Jeux Olympiques d’Athènes (23 et 24 août 2004) et le Décastar (25 et 26 septembre 2004). Lors d’une compétition, les athlètes participent à cinq épreuves (100m, longueur, poids, hauteur, 400m) le premier jour, puis aux épreuves restantes (110m haies, disque, perche, javelot, 1500m) le lendemain. Pour chaque athlète, on dispose de ses performances dans chacune des 10 épreuves, de son classement final, de son nombre de points final et de la compétition à laquelle il a participé.</p>
<section id="plan-de-létude" class="level2">
<h2 class="anchored" data-anchor-id="plan-de-létude">Plan de l’étude</h2>
<ul>
<li>Une étude descriptive simple et bivariée pour identifier des individus atypiques, les varaibles les plus corrélées.</li>
<li>Mettre en place une ACP
<ul>
<li>Bien réfléchir aux variables actives et supplémentaires</li>
<li>Choisir la métrique adaptée et les poids des individus.</li>
<li>Réaliser l’ACP.</li>
</ul></li>
<li>Interprétation
<ul>
<li>Discuter la qualité de la représentation</li>
<li>Expliquer ce qui est visible sur les différents plans factoriels</li>
<li>Combien de plan factoriels vous semblent intéressants ?</li>
<li>Donner un sens aux axes factoriels.</li>
<li>Identifier les disciplines qui se ressemblent (elles mettent en jeu les mêmes compétences physiques)</li>
<li>Quelles sont les disciplines qui contribuent le plus au premier axe factoriel ?</li>
<li>Quels sont les individus qui contribuent le plus à ce même premier axe ?</li>
<li>Comment le score est il lié aux différentes disciplines ?</li>
<li>Est ce qu’un athlète qui est excellent au 100m, est aussi excellent au saut en longueur ?</li>
</ul></li>
<li>Technique
<ul>
<li>Calculer manuellenent (sans package) la corrélation entre les performances au 100m et le premier axe factoriel</li>
<li>Reconstruisez à la main les coordonnées des individus dans le premier plan factoriel</li>
<li>calculer à la main les contributions des différents individus</li>
</ul></li>
</ul>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-sellan2021differences" class="csl-entry" role="listitem">
Sellan, G, FQ Brearley, R Nilus, J Titin, and N Majalap-Lee. 2021. <span>“Differences in Soil Properties Among Contrasting Soil Types in Northern Borneo.”</span> <em>Journal of Tropical Forest Science</em> 33 (2): 191–202.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>